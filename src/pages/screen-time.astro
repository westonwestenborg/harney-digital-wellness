---
import Layout from "../layouts/Layout.astro";
import Cite from "../lib/citations/Cite.astro";
---

<Layout title="Managing Screen Time - Harney County Digital Wellness">
    <div class="min-h-screen bg-base-100">
        <!-- Hero Section -->
        <section class="bg-gradient-to-r from-primary/10 to-secondary/10 py-16">
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-4xl font-bold text-primary mb-4">
                    Managing Screen Time
                </h1>
                <p class="text-xl text-base-content max-w-2xl mx-auto">
                    Tools and strategies to help your family develop healthy
                    screen habits
                </p>
            </div>
        </section>

        <!-- Screen Time Calculator -->
        <section class="py-16">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-2xl text-primary mb-6">
                                Screen Time Calculator
                            </h2>
                            <p class="text-base-content mb-6">
                                Enter your child's current screen time to see
                                how it compares to recommended guidelines and
                                Oregon/National averages.
                            </p>

                            <!-- Interactive Screen Time Calculator -->
                            <form id="screenTimeForm" class="space-y-6">
                                <!-- Age Question -->
                                <div>
                                    <label class="font-semibold"
                                        >What is your child's age?</label
                                    >
                                    <div
                                        class="mt-2 flex flex-col sm:flex-row gap-4"
                                    >
                                        <label class="cursor-pointer flex items-center gap-2"
                                            ><input
                                                type="radio"
                                                name="ageGroup"
                                                value="10-12"
                                                class="radio radio-primary"
                                            />
                                            10–12
                                        </label>
                                        <label class="cursor-pointer flex items-center gap-2"
                                            ><input
                                                type="radio"
                                                name="ageGroup"
                                                value="13-15"
                                                class="radio radio-primary"
                                            />
                                            13–15
                                        </label>
                                        <label class="cursor-pointer flex items-center gap-2"
                                            ><input
                                                type="radio"
                                                name="ageGroup"
                                                value="16-18"
                                                class="radio radio-primary"
                                            />
                                            16–18
                                        </label>
                                    </div>
                                </div>

                                <!-- Screen-time Question -->
                                <div>
                                    <label class="font-semibold"
                                        >On average, how much non-school screen
                                        time does your child have each day?</label
                                    >
                                    <div class="mt-4 w-full text-center">
                                        <input
                                            type="number"
                                            id="totalHoursInput"
                                            step="0.5"
                                            min="0"
                                            max="12"
                                            value="0"
                                            class="input input-bordered w-24 text-center font-bold"
                                        />
                                        <span class="ml-1">hrs/day</span>
                                    </div>
                                    <input
                                        type="range"
                                        id="timeSlider"
                                        min="0"
                                        max="12"
                                        step="0.5"
                                        value="0"
                                        class="range range-primary w-full mt-4"
                                    />
                                </div>

                                <!-- Results -->
                                <div id="resultsSection" class="mt-10 hidden">
                                    <div class="md:flex gap-6">
                                        <!-- Level of concern & recommendations -->
                                        <div id="resultsText" class="md:w-1/2 mb-6 md:mb-0">
                                            <div id="resultMessage" class="alert gap-0 mb-8"></div>
                                            <p id="guidelineText" class="text-sm text-base-content/80 mt-1 mb-6"></p>
                                            <div id="tipsSection" class="mt-6"></div>
                                        </div>

                                        <!-- Comparison bar chart -->
                                        <div class="md:w-1/2">
                                            <canvas id="screenTimeChart" height="220"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Dependencies -->
                                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                                <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

                                <!-- Inline Logic -->
                                <script is:inline>
                                    document.addEventListener("DOMContentLoaded", () => {
                                        const totalInput = document.getElementById("totalHoursInput");
                                        const slider = document.getElementById("timeSlider");

                                        function roundToHalf(val) {
                                            return Math.round(val * 2) / 2;
                                        }

                                        function syncFromSlider(val) {
                                            const hrs = roundToHalf(parseFloat(val));
                                            slider.value = hrs;
                                            totalInput.value = hrs;
                                        }

                                        function syncFromInput() {
                                            let hrs = parseFloat(totalInput.value) || 0;
                                            hrs = roundToHalf(hrs);
                                            if (hrs < 0) hrs = 0;
                                            if (hrs > 12) hrs = 12;
                                            totalInput.value = hrs;
                                            slider.value = hrs;
                                        }

                                        slider.addEventListener("input", (e) =>
                                            syncFromSlider(e.target.value),
                                        );
                                        totalInput.addEventListener("input", syncFromInput);

                                        syncFromSlider(0);

                                        const form = document.getElementById("screenTimeForm");
                                        const results = document.getElementById("resultsSection");
                                        const resultMessage = document.getElementById("resultMessage");
                                        const tipsSection = document.getElementById("tipsSection");
                                        let chart;

                                        form.addEventListener("submit", (e) => {
                                            e.preventDefault();

                                            const ageRadio = document.querySelector(
                                                'input[name="ageGroup"]:checked',
                                            );
                                            if (!ageRadio) {
                                                alert("Please select an age group");
                                                return;
                                            }

                                            const total = parseFloat(totalInput.value) || 0;

                                            const thresholds = {
                                                "10-12": { healthy: 2, caution: 3.5 },
                                                "13-15": { healthy: 2, caution: 4 },
                                                "16-18": { healthy: 2, caution: 4 },
                                            };
                                            const t = thresholds[ageRadio.value];

                                            let category, alertClass, color;
                                            if (total <= t.healthy) {
                                                category = "Healthy";
                                                alertClass = "alert-success";
                                                color = "#4CAF50";
                                            } else if (total <= t.caution) {
                                                category = "Caution";
                                                alertClass = "alert-warning";
                                                color = "#FFC107";
                                            } else {
                                                category = "High Concern";
                                                alertClass = "alert-error";
                                                color = "#F44336";
                                            }

                                            // Prepare chart — three bars comparison
                                            const ctx = document
                                                .getElementById("screenTimeChart")
                                                .getContext("2d");

                                            if (chart) chart.destroy();

                                            chart = new Chart(ctx, {
                                                type: "bar",
                                                data: {
                                                    labels: [
                                                        "Your Child",
                                                        "Oregon Avg",
                                                        "National Avg",
                                                    ],
                                                    datasets: [
                                                        {
                                                            label: "Hours per day",
                                                            data: [total, 3.7, 4.1],
                                                            backgroundColor: [
                                                                "#3B82F6",
                                                                "#2196F3",
                                                                "#9C27B0",
                                                            ],
                                                            borderRadius: 4,
                                                        },
                                                    ],
                                                },
                                                options: {
                                                    responsive: true,
                                                    scales: {
                                                        y: {
                                                            beginAtZero: true,
                                                            suggestedMax: 6,
                                                            title: {
                                                                display: true,
                                                                text: "Hours per day",
                                                            },
                                                        },
                                                    },
                                                    plugins: {
                                                        legend: { display: false },
                                                    },
                                                },
                                            });

                                            // Update result message
                                            resultMessage.className = `alert ${alertClass} gap-0`;
                                            resultMessage.innerHTML = `<span>Your child’s screen time falls in the <strong>${category}</strong> zone. See how it compares in the chart.</span>`;

                                            // guideline text under risk box
                                            const guidelineText = document.getElementById("guidelineText");
                                            guidelineText.textContent = `AAP Guideline: ≤ ${t.healthy} hours/day for your selected age group`;

                                            // Recommendation bullets
                                            const tipsList = {
                                                Healthy: [
                                                    "Encourage creative, screen-free activities like our <a href=\"/harney-digital-wellness/mindful-breaks\" class=\"link link-primary\">Mindful Breaks</a>",
                                                    "Keep routines on track using the <a href=\"/harney-digital-wellness/screen-time#media-plan\" class=\"link link-primary\">Family Media Plan</a> as school and seasons shift",
                                                ],
                                                Caution: [
                                                    "Try a screen-free hour before bed",
                                                    "Set app limits with your device’s controls",
                                                    "Explore the <a href=\"/harney-digital-wellness/screen-time#media-plan\" class=\"link link-primary\">Family Media Plan</a> and <a href=\"/harney-digital-wellness/online-safety#device-settings\" class=\"link link-primary\">Parental Controls Guide</a>",
                                                ],
                                                "High Concern": [
                                                    "Try a 30-minute screen-free block each evening",
                                                    "Use the <a href=\"/harney-digital-wellness/screen-time#tracker\" class=\"link link-primary\">Screen-Time Tracker</a> to spot patterns and set realistic goals",
                                                    "Encourage tech-free moments with our <a href=\"/harney-digital-wellness/mindful-breaks\" class=\"link link-primary\">Mindful Breaks</a>",
                                                    "Create shared boundaries using the <a href=\"/harney-digital-wellness/screen-time#media-plan\" class=\"link link-primary\">Family Media Plan</a>",
                                                ],
                                            };

                                            const bullets = tipsList[category]
                                                .map((item) => `<li>${item}</li>`) 
                                                .join("");

                                            tipsSection.innerHTML = `
                                                <h3 class="font-semibold mb-2">Recommendations based on your child’s screen time:</h3>
                                                <ul class="list-disc pl-5 space-y-1 text-base-content">${bullets}</ul>`;
                                            results.classList.remove("hidden");
                                        });
                                    });
                                </script>

                                <!-- Small calculate button removed; large button below now submits form -->
                                <div class="card-actions justify-center mt-6">
                                    <button
                                        class="btn btn-primary btn-lg"
                                        type="submit"
                                        form="screenTimeForm"
                                    >
                                        Calculate Screen Time
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Impact of Screen Time -->
        <section class="py-16 bg-base-200">
            <div class="container mx-auto px-4">
                <div class="max-w-6xl mx-auto">
                    <h2
                        class="text-3xl font-bold text-center text-primary mb-12"
                    >
                        Understanding Screen Time Impact
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- Depression -->
                        <div class="card bg-base-100 shadow-lg">
                            <div class="card-body">
                                <div
                                    class="w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center mb-4"
                                >
                                    <svg
                                        class="w-6 h-6 text-accent"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0114 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                                        ></path>
                                    </svg>
                                </div>
                                <h3 class="card-title text-lg text-accent">
                                    Mental Health Impact
                                </h3>
                                <ul class="list-disc list-inside text-base-content text-sm space-y-2 mb-4">
                                    <li><strong>Dose matters:</strong> Meta-analyses show that every extra recreational hour above ≈ 2 hrs/day raises the odds of depressive symptoms by 13–20 %, with a stronger effect in girls.<Cite id="liu2016" /><Cite id="li2022" /></li>
                                    <li><strong>Quality over quantity:</strong> A 2025 <em>JAMA</em> cohort study of 4,200 U.S. teens found that addictive use patterns—difficulty logging off, emotional dependence—predicted anxiety, depression, and suicidal thoughts better than total hours online.<Cite id="xiao2025" /></li>
                                    <li><strong>Sleep & mood loop:</strong> Evening screen-light suppresses melatonin, delaying sleep and amplifying next-day irritability; prospective data link late-night use to higher depression scores nine months later.<Cite id="hale2018" /><Cite id="hokby2025" /></li>
                                    <li><strong>Good news:</strong> Families that cut leisure screen use for just one week reported measurable drops in children’s stress and sadness.<Cite id="schmidt2024" /><Cite id="pieh2025" /></li>
                                </ul>
                                <p class="italic text-sm">Take-away: Focus on balanced, purposeful use and tech-free wind-down time rather than rigid minute counts.</p>
                            </div>
                        </div>

                        <!-- School Performance -->
                        <div class="card bg-base-100 shadow-lg">
                            <div class="card-body">
                                <div
                                    class="w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center mb-4"
                                >
                                    <svg
                                        class="w-6 h-6 text-secondary"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                                        ></path>
                                    </svg>
                                </div>
                                <h3 class="card-title text-lg text-secondary">
                                    School Performance
                                </h3>
                                <ul class="list-disc list-inside text-base-content text-sm space-y-2 mb-4">
                                    <li><strong>Grades &amp; homework:</strong> Students exceeding the American Academy of Pediatrics’ 2-hour recreational limit had significantly lower GPA equivalents and reported less homework completion in a 2024 U.S. survey of 220 middle-schoolers.<Cite id="adelantado2019" /></li>
                                    <li><strong>Bedroom screens:</strong> Having a TV or game console in the bedroom predicts a 7–8-point drop on standardized math/reading tests, independent of socioeconomic status.<Cite id="borzekowski2005" /></li>
                                    <li><strong>Classroom distraction:</strong> States and districts limiting smartphones during lessons report improved on-task behavior and test scores, prompting 2025 legislation in Virginia and Los Angeles.<Cite id="beland2016" /><Cite id="paul2024" /></li>
                                </ul>
                                <p class="italic text-sm">Take-away: Keep study spaces device-light and reserve entertainment screens for after assignments are done.</p>
                            </div>
                        </div>

                        <!-- Benefits of Devices -->
                        <div class="card bg-base-100 shadow-lg">
                            <div class="card-body">
                                <div
                                    class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4"
                                >
                                    <svg
                                        class="w-6 h-6 text-primary"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0114 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                                        ></path>
                                    </svg>
                                </div>
                                <h3 class="card-title text-lg text-primary">
                                    Positive Uses
                                </h3>
                                <p class="text-base-content text-sm">
                                    [Pacific Team: Add balanced information
                                    about educational benefits and positive uses
                                    of technology when used mindfully]
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Family Media Plan -->
        <section id="media-plan" class="py-16">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-2xl text-primary mb-6">
                                Create a Family Media Plan
                            </h2>
                            <p class="text-base-content mb-6">
                                Work together as a family to establish healthy
                                digital boundaries that work for everyone.
                            </p>

                            <!-- Family Media Plan Generator -->
                            <div class="bg-base-200 p-8 rounded-lg">
                                <p
                                    class="text-center text-base-content italic mb-4"
                                >
                                    [PACIFIC UNIVERSITY TEAM: Interactive family
                                    media plan generator to be implemented here]
                                </p>
                                <div class="text-sm text-base-content">
                                    <p>
                                        <strong
                                            >Tool should guide families through:</strong>
                                    </p>
                                    <ul
                                        class="list-disc list-inside mt-2 space-y-1"
                                    >
                                        <li>
                                            Setting screen-free times (meals,
                                            bedtime)
                                        </li>
                                        <li>
                                            Defining appropriate content for
                                            each age
                                        </li>
                                        <li>
                                            Creating consequences for plan
                                            violations
                                        </li>
                                        <li>
                                            Establishing positive reinforcement
                                            systems
                                        </li>
                                        <li>Planning alternative activities</li>
                                        <li>
                                            Generating a printable PDF for
                                            family signatures
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card-actions justify-center mt-6">
                                <button class="btn btn-primary btn-lg"
                                    >Create Family Plan</button
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sleep & Screens -->
        <section class="py-16 bg-base-200">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <h2
                        class="text-3xl font-bold text-center text-primary mb-8"
                    >
                        Sleep & Screens
                    </h2>

                    <div class="card bg-base-100 shadow-lg">
                        <div class="card-body">
                            <div class="flex items-center mb-4">
                                <div
                                    class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mr-4"
                                >
                                    <svg
                                        class="w-6 h-6 text-primary"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0112 21a9.003 9.003 0 008.354-5.646z"
                                        ></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-semibold">
                                    Protecting Sleep Quality
                                </h3>
                            </div>

                            <p class="text-base-content mb-6">
                                [Pacific Team: Add content about blue light
                                impact on sleep, recommended screen curfews, and
                                tips for better sleep hygiene]
                            </p>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold mb-2">
                                        Recommended Guidelines:
                                    </h4>
                                    <ul
                                        class="list-disc list-inside text-base-content space-y-1"
                                    >
                                        <li>
                                            [Add age-specific screen curfew
                                            times]
                                        </li>
                                        <li>
                                            [Add blue light filter
                                            recommendations]
                                        </li>
                                        <li>[Add bedroom screen policies]</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-2">
                                        Sleep-Friendly Alternatives:
                                    </h4>
                                    <ul
                                        class="list-disc list-inside text-base-content space-y-1"
                                    >
                                        <li>
                                            [Add bedtime reading suggestions]
                                        </li>
                                        <li>[Add relaxation activities]</li>
                                        <li>
                                            [Add family bonding alternatives]
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tracking Tools -->
        <section id="tracker" class="py-16">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <h2
                        class="text-3xl font-bold text-center text-primary mb-8"
                    >
                        Screen Time Monitoring Tools
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- iOS Tools -->
                        <div class="card bg-base-100 shadow-lg">
                            <div class="card-body">
                                <div class="flex items-center mb-4">
                                    <svg
                                        class="w-8 h-8 text-primary mr-3"
                                        fill="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"
                                        ></path>
                                    </svg>
                                    <h3 class="card-title">iOS Screen Time</h3>
                                </div>
                                <p class="text-base-content mb-4">
                                    [Pacific Team: Add step-by-step guide for
                                    setting up Screen Time on iPhone/iPad]
                                </p>
                                <div class="card-actions">
                                    <a
                                        href="https://support.apple.com/en-us/HT208982"
                                        target="_blank"
                                        class="btn btn-primary btn-sm"
                                    >
                                        Official Apple Guide
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Android Tools -->
                        <div class="card bg-base-100 shadow-lg">
                            <div class="card-body">
                                <div class="flex items-center mb-4">
                                    <svg
                                        class="w-8 h-8 text-primary mr-3"
                                        fill="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M17.523 15.3414c-.5511 0-.9993-.4486-.9993-.9997s.4482-.9993.9993-.9993c.5511 0 .9993.4483.9993.9993 0 .5511-.4482.9997-.9993.9997m-11.046 0c-.5511 0-.9993-.4486-.9993-.9997s.4482-.9993.9993-.9993c.5511 0 .9993.4483.9993.9993 0 .5511-.4482.9997-.9993.9997m11.4045-6.02l1.9973-3.4592a.416.416 0 00-.1567-.5703.416.416 0 00-.5703.1567l-2.0223 3.5014c-1.0048-.4745-2.1349-.7461-3.3508-.7461s-2.3459.2716-3.3507.7461L9.2434 5.8592a.4162.4162 0 00-.5703-.1567.416.416 0 00-.1567.5703l1.9973 3.4592C8.2558 10.5866 6.8147 12.6456 6.8147 15.0092H17.185c0-2.3636-1.441-4.4226-3.7035-5.6678"
                                        ></path>
                                    </svg>
                                    <h3 class="card-title">
                                        Android Digital Wellbeing
                                    </h3>
                                </div>
                                <p class="text-base-content mb-4">
                                    [Pacific Team: Add step-by-step guide for
                                    setting up Digital Wellbeing on Android
                                    devices]
                                </p>
                                <div class="card-actions">
                                    <a
                                        href="https://support.google.com/android/answer/9346420"
                                        target="_blank"
                                        class="btn btn-primary btn-sm"
                                    >
                                        Official Google Guide
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</Layout>
