---
// Assessment Quiz Component for Harney County Digital Wellness
---

<div class="assessment-quiz" id="assessmentQuiz">
    <!-- Quiz Container -->
    <div id="quizContainer" class="space-y-6">
        <div class="progress-bar mb-6">
            <div class="flex justify-end text-sm assessment-text mb-2">
                <span id="progressText">Step 1 of 8</span>
            </div>
            <div class="w-full bg-base-300 rounded-full h-2">
                <div
                    id="progressBar"
                    class="bg-primary h-2 rounded-full transition-all duration-300"
                    style="width: 12.5%"
                >
                </div>
            </div>
        </div>

        <!-- Question 1: Child's Age -->
        <div class="question-card" data-question="1">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        What is your child's age?
                    </h3>
                    <div class="space-y-3">
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <input type="radio" name="age" value="10-12" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">10–12 years old</span>
                            

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <input type="radio" name="age" value="13-15" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">13–15 years old</span>
                            

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <input type="radio" name="age" value="16-18" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">16–18 years old</span>
                            

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 2: Daily Screen Time -->
        <div class="question-card hidden" data-question="2">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        How much recreational screen time does your child have
                        on a typical day?
                    </h3>
                    <div class="space-y-3">
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">Less than 1 hour</span>
                            <input
                                type="radio"
                                name="screenTime"
                                value="<1"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">1-2 hours</span>
                            <input
                                type="radio"
                                name="screenTime"
                                value="1-2"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">2-4 hours</span>
                            <input
                                type="radio"
                                name="screenTime"
                                value="2-4"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">4-6 hours</span>
                            <input
                                type="radio"
                                name="screenTime"
                                value="4-6"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">More than 6 hours</span>
                            <input
                                type="radio"
                                name="screenTime"
                                value="6+"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 3: Sleep Impact -->
        <div class="question-card hidden" data-question="3">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        Does your child use screens within 1 hour of bedtime?
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200">
                            <input type="radio" name="bedtimeScreens" value="never" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:text-white peer-checked:font-semibold">Never</span>
                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Rarely (1-2 times per week)</span
                            >
                            <input
                                type="radio"
                                name="bedtimeScreens"
                                value="rarely"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Sometimes (3-4 times per week)</span
                            >
                            <input
                                type="radio"
                                name="bedtimeScreens"
                                value="sometimes"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Often (5-6 times per week)</span
                            >
                            <input
                                type="radio"
                                name="bedtimeScreens"
                                value="often"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">Every night</span>
                            <input
                                type="radio"
                                name="bedtimeScreens"
                                value="daily"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 4: Social Media -->
        <div class="question-card hidden" data-question="4">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        Does your child use social media platforms?
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200">
                            <input type="radio" name="socialMedia" value="none" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">No social media use</span>
                        </label>
                        <label class="flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200">
                            <input type="radio" name="socialMedia" value="supervised" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">Limited use with supervision</span>
                        </label>
                        <label class="flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200">
                            <input type="radio" name="socialMedia" value="monitored" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">Regular use with some monitoring</span>
                        </label>
                        <label class="flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200">
                            <input type="radio" name="socialMedia" value="unsupervised" class="radio radio-primary peer order-last ml-auto" />
                            <span class="assessment-subtitle w-full peer-checked:font-semibold peer-checked:font-semibold px-2 py-1 rounded-md">Frequent unsupervised use</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 5: Physical Activity -->
        <div class="question-card hidden" data-question="5">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        How often does your child engage in physical activity or
                        outdoor play?
                    </h3>
                    <div class="space-y-3">
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">Daily (1+ hours)</span>
                            <input
                                type="radio"
                                name="physicalActivity"
                                value="daily"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Most days (4-6 times per week)</span
                            >
                            <input
                                type="radio"
                                name="physicalActivity"
                                value="mostDays"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Sometimes (2-3 times per week)</span
                            >
                            <input
                                type="radio"
                                name="physicalActivity"
                                value="sometimes"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Rarely (once per week or less)</span
                            >
                            <input
                                type="radio"
                                name="physicalActivity"
                                value="rarely"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 6: Mood Changes -->
        <div class="question-card hidden" data-question="6">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        Have you noticed mood changes when limiting screen time?
                    </h3>
                    <div class="space-y-3">
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >No significant changes</span
                            >
                            <input
                                type="radio"
                                name="moodChanges"
                                value="none"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Mild frustration that passes quickly</span
                            >
                            <input
                                type="radio"
                                name="moodChanges"
                                value="mild"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Moderate resistance or tantrums</span
                            >
                            <input
                                type="radio"
                                name="moodChanges"
                                value="moderate"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Severe emotional reactions</span
                            >
                            <input
                                type="radio"
                                name="moodChanges"
                                value="severe"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 7: Family Rules -->
        <div class="question-card hidden" data-question="7">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        Do you currently have family rules about screen time?
                    </h3>
                    <div class="space-y-3">
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Yes, clear rules that are consistently followed</span
                            >
                            <input
                                type="radio"
                                name="familyRules"
                                value="consistent"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Yes, but rules are sometimes broken</span
                            >
                            <input
                                type="radio"
                                name="familyRules"
                                value="inconsistent"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Some informal guidelines</span
                            >
                            <input
                                type="radio"
                                name="familyRules"
                                value="informal"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold">No specific rules</span>
                            <input
                                type="radio"
                                name="familyRules"
                                value="none"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question 8: Concerns -->
        <div class="question-card hidden" data-question="8">
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h3 class="card-title assessment-text mb-4">
                        What is your biggest concern about your child's digital
                        habits?
                    </h3>
                    <div class="space-y-3">
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Too much time on screens</span
                            >
                            <input
                                type="radio"
                                name="concerns"
                                value="time"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Impact on sleep or physical health</span
                            >
                            <input
                                type="radio"
                                name="concerns"
                                value="health"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Online safety and cyberbullying</span
                            >
                            <input
                                type="radio"
                                name="concerns"
                                value="safety"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >Impact on schoolwork or social skills</span
                            >
                            <input
                                type="radio"
                                name="concerns"
                                value="academic"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                        <label class="label flex items-center gap-4 p-3 border rounded-lg w-full cursor-pointer hover:bg-base-200 peer-checked:border-primary peer-checked:bg-primary/10">
                            <span class="label-text assessment-subtitle peer-checked:font-semibold"
                                >No significant concerns</span
                            >
                            <input
                                type="radio"
                                name="concerns"
                                value="none"
                                class="radio radio-primary peer order-last ml-auto" />

                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between mt-8">
            <button
                id="prevBtn"
                class="btn btn-outline btn-primary"
                style="display: none;">Previous</button
            >
            <button id="nextBtn" class="btn btn-primary">Next</button>
            <button
                id="submitBtn"
                class="btn btn-primary"
                style="display: none;">Get My Results</button
            >
        </div>
    </div>

    <!-- Results Container -->
    <div id="resultsContainer" class="hidden space-y-6">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-2xl assessment-text mb-4">
                    Your Personalized Assessment Results
                </h2>

                <div id="riskLevel" class="alert mb-6">
                    <div>
                        <h3 class="font-bold text-lg" id="riskTitle"></h3>
                        <p id="riskDescription"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-5 rounded-lg border border-base-300 bg-base-200/40">
                        <h3 id="recommendations-heading" class="font-semibold assessment-text mb-3">
                            Top Recommended Actions:
                        </h3>
                        <ol
                            id="recommendations"
                            aria-labelledby="recommendations-heading"
                            class="list-decimal list-inside space-y-2 assessment-subtitle"
                        >
                        </ol>
                    </div>

                    <div id="resourcesCard" class="p-5 rounded-lg border border-base-300 bg-base-200/40">
                        <h3 class="font-semibold assessment-text mb-3" id="resources-heading">
                            Tools to Help You Take Action:
                        </h3>
                        <div id="personalResourceList" class="flex flex-col gap-3"></div>
                        <details id="moreIdeas" class="mt-3 hidden">
                            <summary class="cursor-pointer text-sm link">More ideas</summary>
                            <div id="extraResourceList" class="flex flex-wrap gap-2 mt-2"></div>
                        </details>
                    </div>
                </div>

                <div class="mt-6 flex flex-wrap gap-2 justify-center" aria-label="Next steps">
                        <a href="/screen-time/" class="badge badge-primary badge-lg" data-badge-topic="screen" target="_blank" rel="noopener noreferrer" aria-label="Next: Deep-dive into Screen Time" data-new-tab>Screen-Time</a>
                        <a href="/online-safety/" class="badge badge-accent badge-lg" data-badge-topic="safety" target="_blank" rel="noopener noreferrer" aria-label="Next: Deep-dive into Online Safety" data-new-tab>Online-Safety</a>
                        <a href="/mindful-breaks/" class="badge badge-secondary badge-lg" data-badge-topic="mindful" target="_blank" rel="noopener noreferrer" aria-label="Next: Mindful Breaks" data-new-tab>Mindful-Breaks</a>
                    </div>

                    <div class="card-actions justify-center mt-6">
                    <button id="restartBtn" class="btn btn-outline btn-primary"
                        >Take Assessment Again</button
                    >
                    
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    class AssessmentQuiz {
        // Explicit property declarations for TypeScript
        currentQuestion: number = 1;
        totalQuestions: number = 8;
        totalSteps: number = 8;
        answers: Record<string, string> = {};
        constructor() {
            this.initializeQuiz();
        }

        initializeQuiz() {
            this.updateProgress();
            this.attachEventListeners();
            this.showCurrentQuestion();
        }

        attachEventListeners() {
            document
                .getElementById("nextBtn")
                .addEventListener("click", () => this.nextQuestion());
            document
                .getElementById("prevBtn")
                .addEventListener("click", () => this.prevQuestion());
            document
                .getElementById("submitBtn")
                .addEventListener("click", () => this.showResults());
            document
                .getElementById("restartBtn")
                .addEventListener("click", () => this.restartQuiz());

            // Listen for radio button changes
            document
                .querySelectorAll('input[type="radio"]')
                .forEach((radio) => {
                    radio.addEventListener("change", () =>
                        this.handleAnswerChange(),
                    );
                });
        }

        handleAnswerChange() {
            const nextBtn = document.getElementById("nextBtn");
            const submitBtn = document.getElementById("submitBtn");

            if (this.currentQuestion < this.totalQuestions) {
                nextBtn.disabled = false;
            } else {
                submitBtn.disabled = false;
            }
        }

        nextQuestion() {
            if (this.currentQuestion < this.totalQuestions) {
                this.saveCurrentAnswer();
                this.currentQuestion++;
                this.showCurrentQuestion();
                this.updateProgress();
                this.updateNavigation();
            }
        }

        prevQuestion() {
            if (this.currentQuestion > 1) {
                this.currentQuestion--;
                this.showCurrentQuestion();
                this.updateProgress();
                this.updateNavigation();
            }
        }

        saveCurrentAnswer() {
            const currentCard = document.querySelector(
                `[data-question="${this.currentQuestion}"]`,
            );
            const selectedAnswer = currentCard.querySelector(
                'input[type="radio"]:checked',
            );
            if (selectedAnswer) {
                this.answers[selectedAnswer.name] = selectedAnswer.value;
            }
        }

        showCurrentQuestion() {
            document.querySelectorAll(".question-card").forEach((card) => {
                card.classList.add("hidden");
            });

            const currentCard = document.querySelector(
                `[data-question="${this.currentQuestion}"]`,
            );
            if (currentCard) {
                currentCard.classList.remove("hidden");
            }
        }

        updateProgress() {
            const progressBar = document.getElementById("progressBar");
            const progressText = document.getElementById("progressText");
            const stepSize = this.totalQuestions / this.totalSteps;
            const currentStep = Math.ceil(this.currentQuestion / stepSize);
            const percentage = (currentStep / this.totalSteps) * 100;

            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `Step ${currentStep} of ${this.totalSteps}`;
        }

        updateNavigation() {
            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");
            const submitBtn = document.getElementById("submitBtn");

            prevBtn.style.display = this.currentQuestion > 1 ? "block" : "none";
            nextBtn.style.display =
                this.currentQuestion < this.totalQuestions ? "block" : "none";
            submitBtn.style.display =
                this.currentQuestion === this.totalQuestions ? "block" : "none";

            // Disable next/submit until answer is selected
            const currentCard = document.querySelector(
                `[data-question="${this.currentQuestion}"]`,
            );
            const hasAnswer = currentCard.querySelector(
                'input[type="radio"]:checked',
            );
            nextBtn.disabled = !hasAnswer;
            submitBtn.disabled = !hasAnswer;
        }

        calculateRiskLevel() {
            let riskScore = 0;

            // Age-based scoring (10–18 years)
            if (
                ["10-12", "13-15"].includes(this.answers.age) &&
                ["4-6", "6+"].includes(this.answers.screenTime)
            )
                riskScore += 2;
            if (
                this.answers.age === "16-18" &&
                this.answers.screenTime === "6+"
            )
                riskScore += 1;

            // Screen time scoring
            if (this.answers.screenTime === "6+") riskScore += 2;
            if (["4-6", "2-4"].includes(this.answers.screenTime))
                riskScore += 1;

            // Sleep impact
            if (["often", "daily"].includes(this.answers.bedtimeScreens))
                riskScore += 2;
            if (this.answers.bedtimeScreens === "sometimes") riskScore += 1;

            // Social media
            if (this.answers.socialMedia === "unsupervised") riskScore += 2;
            if (this.answers.socialMedia === "monitored") riskScore += 1;

            // Physical activity
            if (this.answers.physicalActivity === "rarely") riskScore += 2;
            if (this.answers.physicalActivity === "sometimes") riskScore += 1;

            // Mood changes
            if (this.answers.moodChanges === "severe") riskScore += 2;
            if (this.answers.moodChanges === "moderate") riskScore += 1;

            // Family rules
            if (this.answers.familyRules === "none") riskScore += 1;
            if (this.answers.familyRules === "inconsistent") riskScore += 1;

            return riskScore;
        }

        buildRecommendations() {
            const recs = [];

            // Universal recommendation for every family
            recs.push("Create a family media plan");

            const a = this.answers || {};

            // High / medium concern logic
            // 1. Screen time
            if (a.screenTime === "6+") {
                recs.push("Significantly reduce recreational screen time");
            } else if (["4-6", "2-4"].includes(a.screenTime)) {
                recs.push("Limit recreational screen time to 2 hours or less");
            }

            // 2. Bedtime screen use
            if (["often", "daily"].includes(a.bedtimeScreens)) {
                recs.push("Implement strict bedtime screen curfews");
            } else if (a.bedtimeScreens === "sometimes") {
                recs.push("Avoid screens within 1 hour of bedtime");
            }

            // 3. Social-media supervision
            if (a.socialMedia === "unsupervised") {
                recs.push("Increase supervision of online activities");
            } else if (a.socialMedia === "monitored") {
                recs.push("Continue monitoring social media usage");
            }

            // 4. Physical activity
            if (a.physicalActivity === "rarely") {
                recs.push("Prioritize physical activities and outdoor time");
            } else if (a.physicalActivity === "sometimes") {
                recs.push("Encourage more physical activity each day");
            }

            // 5. Mood changes
            if (a.moodChanges === "severe") {
                recs.push("Consider consulting with a school counselor or pediatrician");
            } else if (a.moodChanges === "moderate") {
                recs.push("Monitor mood changes related to screen time");
            }

            // Remove duplicates while preserving order
            return [...new Set(recs)];
        }

        showResults() {
            this.saveCurrentAnswer();

            const riskScore = this.calculateRiskLevel();
            const quizContainer = document.getElementById("quizContainer");
            const resultsContainer =
                document.getElementById("resultsContainer");

            quizContainer.classList.add("hidden");
            resultsContainer.classList.remove("hidden");

            this.displayResults(riskScore);
        }

        displayResults(riskScore: number) {
            const riskLevelBox = document.getElementById("riskLevel") as HTMLElement;
            const riskTitleEl = document.getElementById("riskTitle") as HTMLElement;
            const riskDescriptionEl = document.getElementById("riskDescription") as HTMLElement;
            const recommendationsEl = document.getElementById("recommendations") as HTMLElement;
            const personalResourceList = document.getElementById("personalResourceList")!;
            const extraResourceList = document.getElementById("extraResourceList")!;
            const moreIdeas = document.getElementById("moreIdeas")! as HTMLDetailsElement;

            let level: string;
            let title: string;
            let description: string;
            let resourceLinks: { text: string; url: string }[];
            let riskLevelStr: "low" | "moderate" | "high" = "low";

            const recs: string[] = this.buildRecommendations();

            

            if (riskScore <= 3) {
                riskLevelStr = "low";
                level = "alert-success";
                title = "Low Risk - Great Foundation!";
                description =
                    "Your family has healthy digital habits with room for minor improvements.";
                resourceLinks = [
                    {
                        text: "Mindful Breaks Activities",
                        url: "/mindful-breaks",
                    },
                    { text: "Maintaining Healthy Habits", url: "/resources" },
                ];
            } else if (riskScore <= 7) {
                riskLevelStr = "moderate";
                level = "alert-warning";
                title = "Moderate Risk - Time for Changes";
                description =
                    "Some aspects of your child's digital habits may benefit from attention and adjustment.";
                resourceLinks = [
                    { text: "Create Family Media Plan", url: "/screen-time" },
                    { text: "Online Safety Guide", url: "/online-safety" },
                    { text: "Screen Time Tools", url: "/screen-time" },
                ];
            } else {
                level = "alert-error text-white";
                title = "Higher Risk - Action Needed";
                description =
                    "Your child's digital habits show several areas of concern that would benefit from immediate attention.";
                resourceLinks = [
                    { text: "Get Professional Help", url: "/get-help#providers" },
                    {
                        text: "Crisis Support Resources",
                        url: "/get-help#crisis",
                    },
                    { text: "Screen Time Management", url: "/screen-time" },
                    { text: "Online Safety Tools", url: "/online-safety" },
                ];
            }

            // Ensure universal link to creating a family media plan appears first
            const mediaPlanLink = { text: "Create Family Media Plan", url: "/screen-time#media-plan" };
            if (!resourceLinks.some((l) => l.url.includes("/screen-time"))) {
                resourceLinks.unshift(mediaPlanLink);
            } else {
                // If a screen-time link already exists but not specific, move the universal one to the front
                const idx = resourceLinks.findIndex((l) => l.url.includes("/screen-time"));
                if (idx > 0) {
                    resourceLinks.splice(idx, 1); // remove existing
                    resourceLinks.unshift(mediaPlanLink);
                }
            }

            riskLevelBox.className = `alert ${level} mb-6`;
            riskTitleEl.textContent = title;
            riskDescriptionEl.textContent = description;

            // Populate personalized resources
            personalResourceList.innerHTML = "";
            extraResourceList.innerHTML = "";
            resourceLinks.forEach((link, idx) => {
                const el = document.createElement("a");
                el.href = link.url;
                el.textContent = link.text;
                el.setAttribute("aria-label", link.text);
                el.target = "_blank";
                el.rel = "noopener noreferrer";
                el.className = "btn btn-outline btn-sm";
                if (idx < 3) {
                    personalResourceList.appendChild(el);
                } else {
                    extraResourceList.appendChild(el);
                }
            });
            // Show accordion only if extras exist
            if (extraResourceList.childElementCount > 0) {
                moreIdeas.classList.remove("hidden");
            } else {
                moreIdeas.classList.add("hidden");
            }

            // Highlight universal badge matching risk level
            document.querySelectorAll("[data-badge-topic]").forEach((badge) => {
                badge.classList.remove("ring", "ring-offset-2", "ring-primary");
            });
            const highlightMap: Record<string,string> = { low: "mindful", moderate: "screen", high: "screen" };
            const topic = highlightMap[riskLevelStr];
            if (topic) {
                const badge = document.querySelector(`[data-badge-topic="${topic}"]`);
                if (badge) {
                    badge.classList.add("ring", "ring-offset-2", "ring-primary");
                }
            }

            recommendationsEl.innerHTML = recs
                .map((rec: string) => `<li>${rec}</li>`)
                .join("");
        }

        restartQuiz() {
            this.currentQuestion = 1;
            this.answers = {};

            const quizContainer = document.getElementById("quizContainer");
            const resultsContainer =
                document.getElementById("resultsContainer");

            resultsContainer.classList.add("hidden");
            quizContainer.classList.remove("hidden");

            // Clear all radio selections
            document
                .querySelectorAll('input[type="radio"]')
                .forEach((radio) => {
                    radio.checked = false;
                });

            this.showCurrentQuestion();
            this.updateProgress();
            this.updateNavigation();
        }
    }

    // Initialize the quiz when the page loads
    document.addEventListener("DOMContentLoaded", () => {
        new AssessmentQuiz();
    });
</script>

<style>
    .question-card {
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .radio:checked {
        background-color: oklch(47.47% 0.222 255.56);
        border-color: oklch(47.47% 0.222 255.56);
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    /* Stacked answer button styles */
    .question-card .label {
        @apply flex items-center gap-4 w-full p-3 border rounded-lg cursor-pointer bg-base-100 hover:bg-base-200 transition;
    }
    .question-card .label + .label {
        @apply mt-3;
    }
    /* ensure inner radio sits right-aligned */
    .question-card .label input[type="radio"] {
        @apply ml-auto radio-primary;
    }
    /* Bold answer text when span follows input (peer variant) */
    .question-card .assessment-subtitle {
        @apply peer-checked:font-semibold;
    }
    /* Fallback bold when label contains checked input regardless of order */
    .question-card label:has(input:checked) .assessment-subtitle {
        font-weight: 600; /* Tailwind font-semibold equivalent */
    }
</style>
